<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Saz' isiXhosa, no Sapho - Ask Khulu</title>
    <style>
        :root {
            --primary-bg: #444;
            --primary-color: white;
            --secondary-bg: #f4f4f4;
            --secondary-color: #333;
            --hover-bg: #555;
            --accent-color: #ffcc80;
        }

        body {
            font-family: 'Quicksand', sans-serif;
            margin: 0;
            line-height: 1.6;
            background-color: var(--secondary-bg);
            color: var(--secondary-color);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .site-title {
            text-align: center;
            padding: 1rem;
            background: var(--primary-bg);
            color: var(--primary-color);
            margin: 0;
            font-size: 2rem;
        }

        header {
            background: var(--primary-bg);
            color: var(--primary-color);
            padding: 1rem;
            display: flex;
            justify-content: center;
        }

        header nav ul {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            gap: 2rem;
        }

        header nav ul li a {
            color: var(--primary-color);
            text-decoration: none;
            font-size: 1.2rem;
        }

        header nav ul li a:hover {
            text-decoration: underline;
        }

        .main-container {
            display: flex;
            flex: 1;
        }

        .sidebar {
            flex: 0 0 200px;
            background: var(--primary-bg);
            color: var(--primary-color);
            height: 100%;
            overflow-y: auto;
        }

        .sidebar ul {
            padding: 0;
            margin: 1rem 0;
            list-style: none;
        }

        .sidebar ul li a {
            display: block;
            padding: 0.8rem 1rem;
            color: var(--primary-color);
            text-decoration: none;
            border-bottom: 1px solid var(--hover-bg);
        }

        .sidebar ul li a:hover {
            background: var(--hover-bg);
        }

        .sidebar ul li a.active {
            background: var(--hover-bg);
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
            }

            .main-container {
                flex-direction: column;
            }
        }

        .content {
            flex: 1;
            padding: 2rem;
            background: url('/img/Sazi_Grandma.jpg') no-repeat center center;
            background-size: cover;
            background-opacity: 0.1;
        }

        @media (max-width: 768px) {
            .content {
                padding: 1rem;
            }
        }

        .section {
            padding: 2rem;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.9);
            margin-bottom: 1rem;
        }

        .section h2 {
            font-size: 1.5rem;
            margin-top: 0;
            color: var(--secondary-color);
        }

        .section a {
            color: var(--accent-color);
            text-decoration: none;
        }

        .section a:hover {
            text-decoration: underline;
        }

        .tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .tabs button {
            padding: 0.5rem 1rem;
            background-color: var(--primary-bg);
            color: var(--primary-color);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }

        .tabs button.active {
            background-color: var(--accent-color);
            color: var(--secondary-color);
        }

        .tabs button:hover {
            background-color: var(--hover-bg);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .qa-form, .search-form {
            max-width: 600px;
            margin: 0 auto;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group input {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-family: 'Quicksand', sans-serif;
        }

        .form-group button {
            padding: 0.5rem 1rem;
            background-color: var(--accent-color);
            color: var(--secondary-color);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }

        .form-group button:hover {
            background-color: #e6b800;
        }

        .qa-response, .search-results {
            margin-top: 1rem;
            padding: 1rem;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        .qa-response p, .search-results p {
            margin: 0.5rem 0;
        }

        .suggestion-box {
            margin-top: 2rem;
            text-align: center;
        }

        footer {
            text-align: center;
            padding: 1rem 0;
            background: var(--primary-bg);
            color: var(--primary-color);
            width: 100%;
        }

        @media (max-width: 768px) {
            header nav ul {
                flex-direction: column;
                gap: 1rem;
            }
        }
    </style>
</head>
<body>
    <h1 class="site-title">Saz' isiXhosa, no Sapho</h1>
    <header>
        <nav>
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="about.html">About Us</a></li>
                <li><a href="contact.html">Contact Us</a></li>
            </ul>
        </nav>
    </header>

    <div class="main-container">
        <div class="sidebar">
            <ul>
                <li><a href="age-levels.html">Age Levels</a></li>
                <li><a href="vocabulary.html">Vocabulary</a></li>
                <li><a href="phrases.html">Phrases</a></li>
                <li><a href="numbers.html">Numbers</a></li>
                <li><a href="time.html">Time</a></li>
                <li><a href="grammar.html">Grammar</a></li>
                <li><a href="culture.html">Culture</a></li>
                <li><a href="activities.html">Activities</a></li>
                <li><a href="ask-khulu.html" class="active">Ask Khulu</a></li>
            </ul>
        </div>

        <div class="content">
            <div id="ask-khulu" class="section">
                <h2>Ask Khulu</h2>
                <p>Ask Khulu, Sazi’s grandmother, your Xhosa questions or search our site! Her wisdom lights the way with stories and love.</p>
                <div class="tabs">
                    <button class="tab-button active" onclick="showTab('ask')">Ask Khulu</button>
                    <button class="tab-button" onclick="showTab('search')">Search Site</button>
                </div>
                <div id="ask" class="tab-content active">
                    <div class="qa-form">
                        <div class="form-group">
                            <input type="text" id="qa-input" placeholder="Ask Khulu a question (e.g., What is Molo?)">
                            <button onclick="submitQuestion()">Ask</button>
                        </div>
                        <div class="qa-response" id="qaResponse"></div>
                    </div>
                </div>
                <div id="search" class="tab-content">
                    <div class="search-form">
                        <div class="form-group">
                            <input type="text" id="search-input" placeholder="Search for a word or practice (e.g., Ikati, Imbeleko)">
                            <button onclick="searchSite()">Search</button>
                        </div>
                        <div class="search-results" id="searchResults"></div>
                    </div>
                </div>
                <div class="suggestion-box">
                    <h3>Want to Share or Ask More?</h3>
                    <p>Still haven’t found an answer or have a suggestion? Please <a href="contact.html">contact us</a> with your question, comment, or idea—we love expanding Khulu’s wisdom!</p>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <p>© 2025 Mdeni Family</p>
    </footer>

    <script>
        // Predefined Q&A pairs for specific questions
        const qaDatabase = [
            {
                question: 'What is Molo?',
                answer: 'My dear, *Molo* is how we greet our loved ones with a smile, bringing warmth to our hearts.'
            },
            {
                question: 'Why do we do Imbeleko?',
                answer: 'Oh, my child, *Imbeleko* is a special time when we wrap a newborn in love and introduce them to our community, like a warm hug from our ancestors.'
            },
            {
                question: 'What is Intlonipho?',
                answer: 'Sweet one, *Intlonipho* is the respect we show our elders with kind words and gentle actions, making our family strong.'
            },
            {
                question: 'Tell me a Xhosa story',
                answer: 'Come close, my love, let me tell you of a brave child who learned courage under the Transkei stars, listening to whispers of our ancestors. Shall I share another tale?'
            },
            {
                question: 'What does Kusasa mean?',
                answer: 'My precious, *Kusasa* is the morning, when the sun rises and we start our day with joy and hope.'
            }
        ];

        // Simple Levenshtein distance for fuzzy matching
        function levenshtein(a, b) {
            const matrix = Array(b.length + 1).fill().map(() => Array(a.length + 1).fill(0));
            for (let i = 0; i <= a.length; i++) matrix[0][i] = i;
            for (let j = 0; j <= b.length; j++) matrix[j][0] = j;
            for (let j = 1; j <= b.length; j++) {
                for (let i = 1; i <= a.length; i++) {
                    const indicator = a[i - 1] === b[j - 1] ? 0 : 1;
                    matrix[j][i] = Math.min(
                        matrix[j][i - 1] + 1,
                        matrix[j - 1][i] + 1,
                        matrix[j - 1][i - 1] + indicator
                    );
                }
            }
            return matrix[b.length][a.length];
        }

        // Normalize term by removing common prefixes like "I-" and converting to lowercase
        function normalizeTerm(term) {
            return term.toLowerCase().replace(/^(i-|u-|ama-|izi-)/, '');
        }

        async function loadDatabase() {
            try {
                const response = await fetch('/resources/content-database.json');
                if (!response.ok) throw new Error('Failed to load database');
                return await response.json();
            } catch (error) {
                console.error('Error loading database:', error);
                return { categories: [] }; // Fallback empty database
            }
        }

        function submitQuestion() {
            const input = document.getElementById('qa-input').value.trim().toLowerCase();
            const responseDiv = document.getElementById('qaResponse');

            // Check predefined Q&A first
            const qaMatch = qaDatabase.find(q => q.question.toLowerCase().includes(input));
            if (qaMatch) {
                responseDiv.innerHTML = `<p>${qaMatch.answer}</p>`;
                return;
            }

            // Query JSON database
            loadDatabase().then(data => {
                let bestMatch = null;
                let bestScore = Infinity;
                let answer = '';

                data.categories.forEach(category => {
                    if (category.subcategories) {
                        category.subcategories.forEach(sub => {
                            sub.entries.forEach(entry => {
                                const xhosaNormalized = normalizeTerm(entry.xhosa);
                                const englishNormalized = normalizeTerm(entry.english);
                                const inputNormalized = normalizeTerm(input);
                                const xhosaScore = levenshtein(inputNormalized, xhosaNormalized);
                                const englishScore = levenshtein(inputNormalized, englishNormalized);

                                if (xhosaScore < bestScore) {
                                    bestScore = xhosaScore;
                                    bestMatch = entry;
                                }
                                if (englishScore < bestScore) {
                                    bestScore = englishScore;
                                    bestMatch = entry;
                                }

                                // Exact or partial match
                                if (input.includes(entry.xhosa.toLowerCase()) || input.includes(entry.english.toLowerCase()) ||
                                    xhosaNormalized.includes(inputNormalized) || englishNormalized.includes(inputNormalized)) {
                                    answer = `My child, ${entry.xhosa} means "${entry.english}" - ${entry.description} You’re learning so beautifully!`;
                                }
                            });
                        });
                    } else {
                        category.entries.forEach(entry => {
                            const xhosaNormalized = normalizeTerm(entry.xhosa);
                            const englishNormalized = normalizeTerm(entry.english);
                            const inputNormalized = normalizeTerm(input);
                            const xhosaScore = levenshtein(inputNormalized, xhosaNormalized);
                            const englishScore = levenshtein(inputNormalized, englishNormalized);

                            if (xhosaScore < bestScore) {
                                bestScore = xhosaScore;
                                bestMatch = entry;
                            }
                            if (englishScore < bestScore) {
                                bestScore = englishScore;
                                bestMatch = entry;
                            }

                            if (input.includes(entry.xhosa.toLowerCase()) || input.includes(entry.english.toLowerCase()) ||
                                xhosaNormalized.includes(inputNormalized) || englishNormalized.includes(inputNormalized)) {
                                answer = `My child, ${entry.xhosa} means "${entry.english}" - ${entry.description} You’re learning so beautifully!`;
                            }
                        });
                    }
                });

                if (answer) {
                    responseDiv.innerHTML = `<p>${answer}</p>`;
                } else if (bestMatch && bestScore < 5) { // Threshold for close match
                    responseDiv.innerHTML = `<p>My sweet, I don’t know that one exactly, but perhaps you meant ${bestMatch.xhosa}, our word for "${bestMatch.english}"? It means ${bestMatch.description} Keep asking, you’re doing wonderfully!</p>`;
                } else {
                    responseDiv.innerHTML = `<p>Oh, my love, I don’t recall that word, but don’t worry! Would you like to <a href="https://www.google.com/search?q=${encodeURIComponent(input)}" target="_blank">search for it online</a>? Or try another question, dear.</p>`;
                }
            }).catch(error => {
                responseDiv.innerHTML = `<p>My dear, I’m having a little trouble today. Try asking again or <a href="contact.html">contact us</a> with your question!</p>`;
            });
        }

        function searchSite() {
            const input = document.getElementById('search-input').value.trim().toLowerCase();
            const resultsDiv = document.getElementById('searchResults');

            loadDatabase().then(data => {
                const matches = [];
                let bestMatch = null;
                let bestScore = Infinity;

                data.categories.forEach(category => {
                    if (category.subcategories) {
                        category.subcategories.forEach(sub => {
                            sub.entries.forEach(entry => {
                                const xhosaNormalized = normalizeTerm(entry.xhosa);
                                const englishNormalized = normalizeTerm(entry.english);
                                const inputNormalized = normalizeTerm(input);
                                const xhosaScore = levenshtein(inputNormalized, xhosaNormalized);
                                const englishScore = levenshtein(inputNormalized, englishNormalized);

                                if (xhosaScore < bestScore) {
                                    bestScore = xhosaScore;
                                    bestMatch = entry;
                                }
                                if (englishScore < bestScore) {
                                    bestScore = englishScore;
                                    bestMatch = entry;
                                }

                                if (input.includes(entry.xhosa.toLowerCase()) || input.includes(entry.english.toLowerCase()) ||
                                    xhosaNormalized.includes(inputNormalized) || englishNormalized.includes(inputNormalized) ||
                                    entry.description.toLowerCase().includes(input)) {
                                    matches.push({
                                        english: entry.english,
                                        xhosa: entry.xhosa,
                                        description: entry.description,
                                        when: entry.when_performed || entry.when_used || ''
                                    });
                                }
                            });
                        });
                    } else {
                        category.entries.forEach(entry => {
                            const xhosaNormalized = normalizeTerm(entry.xhosa);
                            const englishNormalized = normalizeTerm(entry.english);
                            const inputNormalized = normalizeTerm(input);
                            const xhosaScore = levenshtein(inputNormalized, xhosaNormalized);
                            const englishScore = levenshtein(inputNormalized, englishNormalized);

                            if (xhosaScore < bestScore) {
                                bestScore = xhosaScore;
                                bestMatch = entry;
                            }
                            if (englishScore < bestScore) {
                                bestScore = englishScore;
                                bestMatch = entry;
                            }

                            if (input.includes(entry.xhosa.toLowerCase()) || input.includes(entry.english.toLowerCase()) ||
                                xhosaNormalized.includes(inputNormalized) || englishNormalized.includes(inputNormalized) ||
                                entry.description.toLowerCase().includes(input)) {
                                matches.push({
                                    english: entry.english,
                                    xhosa: entry.xhosa,
                                    description: entry.description,
                                    when: entry.when_performed || entry.when_used || ''
                                });
                            }
                        });
                    }
                });

                if (matches.length > 0) {
                    resultsDiv.innerHTML = matches.map(match => `
                        <p><strong>${match.english} / ${match.xhosa}</strong>: ${match.description}${match.when ? ` (${match.when})` : ''} Keep exploring, my dear!</p>
                    `).join('');
                } else if (bestMatch && bestScore < 5) {
                    resultsDiv.innerHTML = `<p>My sweet one, I didn’t find that exact word, but perhaps you meant ${bestMatch.xhosa}, our word for "${bestMatch.english}"? It means ${bestMatch.description} Try another, love!</p>`;
                } else {
                    resultsDiv.innerHTML = `<p>Oh, my precious, I couldn’t find that one, but don’t lose heart! Would you like to <a href="https://www.google.com/search?q=${encodeURIComponent(input)}" target="_blank">search for it online</a>? Or try another word, dear.</p>`;
                }
            }).catch(error => {
                resultsDiv.innerHTML = `<p>My love, I’m having a little trouble searching today. Please try again or <a href="contact.html">contact us</a> with your question!</p>`;
            });
        }
    </script>
</body>
</html>
